{% extends 'admin/base.html.twig' %}

{% block title %}Meals{% endblock %}

{% block body %}
<h1 class="text-2xl font-bold mb-6">Meal Management</h1>

{# Navigation buttons #}
<div class="flex gap-3 mb-6">
    <a href="{{ path('app_user_well_being_data_index') }}"
       class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 flex items-center gap-2">
        <i class="fas fa-heart"></i>
        Well-Being Section
    </a>

    <a href="{{ path('app_meal_new') }}"
       class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 flex items-center gap-2">
        <i class="fas fa-plus"></i>
        Add Meal
    </a>
</div>
{# ---------------- STATS CARDS ---------------- #}
<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
    <!-- Total Meals -->
    <div class="bg-white shadow-lg rounded-xl p-5 flex items-center justify-between">
        <div>
            <p class="text-sm font-medium text-gray-500">Total Meals</p>
            <p class="text-2xl font-bold text-gray-900">{{ stats.totalMeals }}</p>
        </div>
        <div class="bg-blue-100 text-blue-600 rounded-full p-3">
            <i class="fas fa-utensils text-xl"></i>
        </div>
    </div>

    <!-- Meals With Image -->
    <div class="bg-white shadow-lg rounded-xl p-5 flex items-center justify-between">
        <div>
            <p class="text-sm font-medium text-gray-500">Meals With Image</p>
            <p class="text-2xl font-bold text-green-600">{{ stats.withImage }}</p>
        </div>
        <div class="bg-green-100 text-green-600 rounded-full p-3">
            <i class="fas fa-image text-xl"></i>
        </div>
    </div>

    <!-- Meals Without Image -->
    <div class="bg-white shadow-lg rounded-xl p-5 flex items-center justify-between">
        <div>
            <p class="text-sm font-medium text-gray-500">Meals Without Image</p>
            <p class="text-2xl font-bold text-red-600">{{ stats.withoutImage }}</p>
        </div>
        <div class="bg-red-100 text-red-600 rounded-full p-3">
            <i class="fas fa-ban text-xl"></i>
        </div>
    </div>

    <!-- Average Description Length -->
    <div class="bg-white shadow-lg rounded-xl p-5 flex items-center justify-between">
        <div>
            <p class="text-sm font-medium text-gray-500">Avg Description Length</p>
            <p class="text-2xl font-bold text-gray-900">{{ stats.avgDescriptionLength|number_format(0) }}</p>
        </div>
        <div class="bg-purple-100 text-purple-600 rounded-full p-3">
            <i class="fas fa-align-left text-xl"></i>
        </div>
    </div>
</div>

{# ---------------- SEARCH + SORT FORM ---------------- #}
<form method="get" class="flex items-center gap-2 mb-4">
    <!-- Search input -->
    <input type="text" name="search" placeholder="Search description..." 
           value="{{ searchTerm|default('') }}" 
           class="border px-3 py-1 rounded-lg">

    <!-- Sort field -->
    <select name="sortField" class="border px-3 py-1 rounded-lg">
        {% set fields = {
            'id': 'ID',
            'description': 'Description',
            'createAt': 'Created At'
        } %}
        {% for key, label in fields %}
            <option value="{{ key }}" {% if sortField == key %}selected{% endif %}>{{ label }}</option>
        {% endfor %}
    </select>

    <!-- Sort direction with arrows -->
    <select name="sortDirection" class="border px-3 py-1 rounded-lg">
        <option value="asc" {% if sortDirection == 'asc' %}selected{% endif %}>Ascending ↑</option>
        <option value="desc" {% if sortDirection == 'desc' %}selected{% endif %}>Descending ↓</option>
    </select>

    <!-- Submit button -->
    <button type="submit" class="bg-blue-600 text-white px-4 py-1 rounded-lg hover:bg-blue-700">
        Apply
    </button>
</form>

{# Table #}
<table class="table-auto w-full border-collapse border border-gray-200">
    <thead>
        <tr class="bg-gray-100">
            <th class="border px-2 py-2">Id</th>
            <th class="border px-2 py-2">Image</th>
            <th class="border px-2 py-2">Description</th>
            <th class="border px-2 py-2">AI Analysis</th>
            <th class="border px-2 py-2">Created At</th>
            <th class="border px-2 py-2">Actions</th>
        </tr>
    </thead>
    <tbody>
    {% for meal in meals %}
        <tr class="text-center">
            <td class="border px-2 py-2">{{ meal.id }}</td>

            {# Image preview #}
            <td class="border px-2 py-2">
                {% if meal.imageName %}
                    <img src="{{ asset('uploads/meals/' ~ meal.imageName) }}"
                         class="h-16 w-16 object-cover rounded mx-auto">
                {% else %}
                    <span class="text-gray-400">No image</span>
                {% endif %}
            </td>

            <td class="border px-2 py-2">
                {{ meal.description|slice(0, 50) }}...
            </td>

            <td class="border px-2 py-2">
                {{ meal.aiAnalysis|slice(0, 50) }}...
            </td>

            <td class="border px-2 py-2">
                {{ meal.createAt ? meal.createAt|date('Y-m-d H:i') : '' }}
            </td>

            {# Action icons #}
            <td class="border px-2 py-2 flex gap-3 justify-center">
                <a href="{{ path('app_meal_show', {'id': meal.id}) }}"
                   class="text-blue-600 hover:text-blue-800" title="View">
                    <i class="fas fa-eye"></i>
                </a>

                <a href="{{ path('app_meal_edit', {'id': meal.id}) }}"
                   class="text-green-600 hover:text-green-800" title="Edit">
                    <i class="fas fa-edit"></i>
                </a>
            </td>
        </tr>
    {% else %}
        <tr>
            <td colspan="6" class="text-center py-4 text-gray-500">
                No meals found
            </td>
        </tr>
    {% endfor %}
    </tbody>
</table>

{% endblock %}
