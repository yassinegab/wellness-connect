{% extends 'base.html.twig' %}

{% block title %}Ajouter Symptomes{% endblock %}

{% block body %}
<div class="flex min-h-screen bg-background">
  {% include 'components/sidebar.html.twig' %}
  <div class="flex flex-1 flex-col">
    {% include 'components/top-nav.html.twig' %}
    <main class="flex-1 overflow-auto">
      <div class="mx-auto max-w-7xl space-y-6 p-4 lg:p-6">

        <!-- Header -->
        <div class="flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between">
          <div class="flex items-center gap-2 rounded-md border px-3 py-2"> {{ "now"|date("l d F Y") }}</div>
        </div>
    
<h2 class="text-2xl font-bold text-pink-600 mb-4">Ajouter vos sympt么mes </h2>

<div id="symptomes-list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
    {% for symptome in symptomesDisponibles %}
   <div class="symptome-item chroma-card"
     data-symptome="{{ symptome.value }}">

    <div class="chroma-bg"></div>

    <div class="chroma-content">
        <div class="symptome-label font-medium">
            {{ symptome.label }}
        </div>

        <select class="intensite-select" disabled>
            <option value="">Choisir l'intensit茅 </option>
            {% for label, value in intensites %}
                <option value="{{ value }}">{{ label }}</option>
            {% endfor %}
        </select>

        <input type="date" class="date-observation" disabled>
    </div>
</div>
    {% endfor %}
</div>

<div class="flex gap-4 mt-6">
    <button id="save-symptomes" class="px-6 py-2 bg-pink-500 text-white font-semibold rounded-2xl hover:bg-pink-600 transition">Enregistrer</button>
    <a href="{{ path('cycle') }}" class="btn-outline">
                    Annuler
                </a>
</div>
<div>
<a href="{{ path('symptome_list') }}"
   class="px-6 py-2 bg-pink-400 text-white font-semibold rounded-2xl hover:bg-pink-500 transition">
     Voir mes sympt么mes
</a>
    
    </div>


{% endblock %}

{% block javascripts %}
<script>


const symptomeItems = document.querySelectorAll('.symptome-item');

symptomeItems.forEach(item => {
    // Clique sur la card pour activer
    item.addEventListener('click', (e) => {
        // Emp锚che la propagation si on clique sur le select ou date
        if(e.target.tagName === 'SELECT' || e.target.tagName === 'INPUT') return;

        const isActive = item.classList.toggle('selected');
        const intensiteSelect = item.querySelector('.intensite-select');
        const dateInput = item.querySelector('.date-observation');
        intensiteSelect.disabled = !isActive;
        dateInput.disabled = !isActive;

        if(isActive) {
            item.classList.add('bg-pink-300', 'shadow-md');
        } else {
            item.classList.remove('bg-pink-300', 'shadow-md');
        }
    });
});

// Bouton Enregistrer
document.getElementById('save-symptomes').addEventListener('click', async () => {
    const data = [];
    symptomeItems.forEach(item => {
        if(item.classList.contains('selected')) {
            data.push({
                type: item.dataset.symptome,
                intensite: item.querySelector('.intensite-select').value,
                dateObservation: item.querySelector('.date-observation').value
            });
        }
    });

    if(data.length === 0){
        alert("Veuillez s茅lectionner au moins un sympt么me.");
        return;
    }

    const response = await fetch('{{ path('symptome_create') }}', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(data)
    });

    if (response.ok) {
        alert('Sympt么mes enregistr茅s ! ');
        location.reload();
    } else {
        alert('Erreur lors de l\'enregistrement.');
    }
});

// Bouton Annuler
document.getElementById('cancel-symptomes').addEventListener('click', () => {
    symptomeItems.forEach(item => {
        item.classList.remove('selected', 'bg-pink-300', 'shadow-md');
        item.querySelector('.intensite-select').disabled = true;
        item.querySelector('.date-observation').disabled = true;
        item.querySelector('.intensite-select').value = "";
        item.querySelector('.date-observation').value = "";
    });
});
</script>
{% endblock %}
{% block stylesheets %}
<style>
/* === CHROMA CARD === */
.chroma-card {
    position: relative;
    border-radius: 1.5rem;
    padding: 1.2rem;
    background: #fff1f2;
    cursor: pointer;
    overflow: hidden;
    transition: transform .25s ease, box-shadow .25s ease;
    --mx: 50%;
    --my: 50%;
}

/* gradient vivant */
.chroma-bg {
    position: absolute;
    inset: -2px;
    background: radial-gradient(
        300px at var(--mx) var(--my),
        rgba(236,72,153,0.45),
        transparent 70%
    );
    opacity: 0;
    transition: opacity .3s ease;
}

/* contenu au dessus */
.chroma-content {
    position: relative;
    z-index: 2;
    display: flex;
    flex-direction: column;
    gap: .6rem;
}

/* hover */
.chroma-card:hover {
    transform: translateY(-6px) scale(1.04);
    box-shadow: 0 20px 45px rgba(236,72,153,.35);
}

.chroma-card:hover .chroma-bg {
    opacity: 1;
}

/* selected */
.chroma-card.selected {
    background: linear-gradient(135deg,#fce7f3,#fbcfe8);
    box-shadow: 0 25px 55px rgba(236,72,153,.45);
}

/* inputs */
.chroma-card select,
.chroma-card input {
    border-radius: 999px;
    border: 2px solid #fbcfe8;
    padding: .4rem .8rem;
    transition: all .25s ease;
}

.chroma-card select:focus,
.chroma-card input:focus {
    outline: none;
    border-color: #ec4899;
    box-shadow: 0 0 0 4px rgba(236,72,153,.25);
}
</style>
{% endblock %}