{% extends 'base.html.twig' %}

{% block body %}
<div class="flex min-h-screen bg-background">

  {# Sidebar #}
  {% include 'components/sidebar.html.twig' %}

  <div class="flex flex-1 flex-col">

    {# Top Navigation #}
    {% include 'components/top-nav.html.twig' %}

    <main class="flex-1 overflow-auto">
      <div class="mx-auto max-w-7xl space-y-6 p-4 lg:p-6">

        <h2 class="text-2xl font-extrabold text-pink-700 mb-6">üå∏ Historique des cycles</h2>

        {% if cycles is empty %}
            <p class="text-pink-300 font-semibold">Aucun cycle enregistr√©.</p>
        {% else %}
            <div class="cycle-list-container max-w-5xl mx-auto">

                {% for i in 0..cycles|length - 1 %}
                    {% set cycle = cycles[i] %}
                    {% set nextCycle = cycles[i + 1] is defined ? cycles[i + 1] : null %}
                    {% set cycleLength = nextCycle ? cycle.dateDebutM.diff(nextCycle.dateDebutM).days : 'N/A' %}
                    {% set dureeMenstruation = cycle.dateDebutM.diff(cycle.dateFinM ).days + 1 %}
<div class="cycle-item" data-index="{{ loop.index0 }}">
    <div class="cycle-content p-6 rounded-3xl bg-lilac-100 border-4 border-lilac-400 shadow-lg hover:shadow-2xl transition-all duration-300 text-lilac-900">
        <div class="mb-3">
            <h3 class="text-lg font-bold text-lilac-700 mb-1">Cycle #{{ i + 1 }} üå∏</h3>
            <p><strong class="text-lilac-600">D√©but :</strong> 
               <span class="text-lilac-800 font-semibold">{{ cycle.dateDebutM|date('d/m/Y') }}</span>
            </p>
            <p><strong class="text-lilac-600">Fin :</strong> 
               <span class="text-lilac-800 font-semibold">{{ cycle.dateFinM|date('d/m/Y') }}</span>
            </p>
        </div>
        <div class="flex justify-between mt-2">
            <p><strong class="text-lilac-600">Dur√©e :</strong> 
               <span class="text-lilac-700 font-medium">{{ cycleLength }} jours</span>
            </p>
            <p><strong class="text-lilac-600">Menstruation :</strong> 
               <span class="text-lilac-700 font-medium">{{ dureeMenstruation }} jours</span>
            </p>
        </div>
    </div>
</div>
                {% endfor %}

            </div>
        {% endif %}

        <div class="mt-6">
            <a href="{{ path('cycle_index') }}" class="text-pink-600 hover:text-pink-800 hover:underline font-semibold">
                ‚Üê Retour
            </a>
        </div>

      </div>
    </main>

  </div>
</div>
{% endblock %}

{% block stylesheets %}
<style>
.cycle-list-container {
    display: grid;
    grid-template-columns: 1fr;
    gap: 1.5rem;
}

@media (min-width: 768px) {
    .cycle-list-container {
        grid-template-columns: repeat(2, 1fr);
    }
}

@media (min-width: 1024px) {
    .cycle-list-container {
        grid-template-columns: repeat(3, 1fr);
    }
}

/* Cycle cards */
.cycle-item {
    cursor: pointer;
    transform: scale(0.95);
    opacity: 0;
    animation: fadeIn 0.35s ease forwards;
}

.cycle-item:hover .cycle-content {
    transform: scale(1.07);
    box-shadow: 0 25px 50px rgba(236, 72, 153, 0.35);
}

.cycle-content {
    transition: all 0.3s ease;
    color: #9d174d;
    background: linear-gradient(135deg, #fbcfe8 0%, #f472b6 50%, #ec4899 100%);
    border-radius: 2rem; /* Rounded edges */
    border: 4px solid #f43f5e;
    padding: 1.5rem;
    position: relative;
}

/* Animations */
@keyframes fadeIn {
    to {
        opacity: 1;
        transform: scale(1);
    }
}
</style>
{% endblock %}

{% block javascripts %}
<script>
document.addEventListener('DOMContentLoaded', () => {
    const items = document.querySelectorAll('.cycle-item');
    let selectedIndex = -1;

    items.forEach((item, index) => {
        item.addEventListener('mouseenter', () => {
            clearActive();
            item.classList.add('active');
            selectedIndex = index;
        });
        item.addEventListener('click', () => {
            // Optionnel: redirection vers page d√©tail cycle
        });
    });

    function clearActive() {
        items.forEach(i => i.classList.remove('active'));
    }

    document.addEventListener('keydown', e => {
        if (e.key === 'ArrowDown') {
            selectedIndex = Math.min(selectedIndex + 1, items.length - 1);
        } else if (e.key === 'ArrowUp') {
            selectedIndex = Math.max(selectedIndex - 1, 0);
        } else if (e.key === 'Enter' && selectedIndex >= 0) {
            items[selectedIndex].click();
        }

        clearActive();
        if (items[selectedIndex]) {
            items[selectedIndex].classList.add('active');
            items[selectedIndex].scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
    });
});
</script>
{% endblock %}