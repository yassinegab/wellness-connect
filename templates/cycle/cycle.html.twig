{% extends 'base.html.twig' %}

{% block body %}
<div class="flex min-h-screen bg-background">

  {# Sidebar #}
  {% include 'components/sidebar.html.twig' %}

  <div class="flex flex-1 flex-col">

    {# Top Navigation #}
    {% include 'components/top-nav.html.twig' %}

    <main class="flex-1 overflow-auto">
      <div class="mx-auto max-w-7xl space-y-6 p-4 lg:p-6">

        {# Header #}
        <div class="flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between">
          <div>
            <h1 class="text-2xl font-bold text-foreground">
              Bonjour, {{ user.prenom }} !
            </h1>
            <p class="text-muted-foreground">
              Voici un aperÃ§u de votre santÃ© aujourdâ€™hui
            </p>
          </div>

          <div class="flex items-center gap-2 rounded-md border px-3 py-2">
            ðŸ“… {{ "now"|date("l d F Y") }}
          </div>
        </div>
        
        <div id="calendar"></div>

<script>
document.addEventListener('DOMContentLoaded', function () {
  let calendar = new FullCalendar.Calendar(document.getElementById('calendar'), {
    initialView: 'dayGridMonth',
    locale: 'fr',

    selectable: true,      // â­ IMPORTANT
    selectMirror: true,

    events: {{ calendarEvents|default('[]')|raw }},

    select: function(info) {
      // info.startStr â†’ date dÃ©but
      // info.endStr   â†’ date fin (exclusive)

      if (confirm("Ajouter un cycle Ã  partir de cette sÃ©lection ?")) {
        addCycle(info.startStr, info.endStr);
      }
    }
  });

  calendar.render();

  function addCycle(start, end) {
    fetch("{{ path('cycle_add_ajax') }}", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "X-Requested-With": "XMLHttpRequest"
      },
      body: JSON.stringify({
        start: start,
        end: end
      })
    })
    .then(res => res.json())
    .then(data => {
      if (data.success) {
        calendar.addEvent({
          title: 'Cycle menstruel',
          start: start,
          end: end,
          color: '#ef4444'
        });
      }
    });
  }
});
</script>

        

      </div>
    
  
    </main>

  
  

</div>
{% endblock %}
