{% extends 'base.html.twig' %}

{% block stylesheets %}
<style>
/* ðŸŒ¸ ThÃ¨me gÃ©nÃ©ral rose */
.fc {
  --fc-border-color: #fbcfe8;
  --fc-today-bg-color: #fce7f3;
  --fc-page-bg-color: #fff1f2;
  font-family: 'Inter', sans-serif;
}

/* ðŸŒ¸ Header */
.fc-toolbar-title {
  color: #be185d;
  font-weight: 600;
}

.fc-button {
  background-color: #f9a8d4 !important;
  border: none !important;
  color: white !important;
}

.fc-button:hover {
  background-color: #f472b6 !important;
}

/* ðŸŒ¸ Jours */
.fc-daygrid-day-number {
  color: #9d174d;
  font-weight: 500;
}

/* ðŸŒ¸ Jour actuel */
.fc-day-today {
  background-color: #fce7f3 !important;
}

/* ðŸ©¸ IcÃ´ne menstruation */
.fc-event {
  background: transparent !important;
  border: none !important;
  font-size: 1.3rem;
}
/* ðŸ©¸ PÃ©riode menstruelle - motif sang */
.menstruation-event {
  background-color: transparent !important;
  border: none !important;


  border-radius: 6px;
}

/* Supprimer le texte (au cas oÃ¹) */
.fc-event-title {
  display: none;
}

</style>

{% endblock %}


{% block body %}
<div class="flex min-h-screen bg-background">

  {# Sidebar #}
  {% include 'components/sidebar.html.twig' %}

  <div class="flex flex-1 flex-col">

    {# Top Navigation #}
    {% include 'components/top-nav.html.twig' %}

    <main class="flex-1 overflow-auto">
      <div class="mx-auto max-w-7xl space-y-6 p-4 lg:p-6">

        {# Header #}
        <div class="flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between">
          <div>
            <h1 class="text-2xl font-bold text-foreground">
              Bonjour, {{ user.prenom }} !
            </h1>
            <p class="text-muted-foreground">
              Voici un aperÃ§u de votre santÃ© aujourdâ€™hui
            </p>
          </div>

          <div class="flex items-center gap-2 rounded-md border px-3 py-2">
            ðŸ“… {{ "now"|date("l d F Y") }}
          </div>
        </div>
        
<div id="calendar"></div>

<script>
document.addEventListener('DOMContentLoaded', function () {

    const calendarEl = document.getElementById('calendar');

    const calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        locale: 'fr',
        selectable: true,
        selectMirror: true,
        unselectAuto: true,
        height: 650,

        events: {{ calendarEvents|default('[]')|raw }},

        select: function(info) {
            const start = info.start;
            const endExclusive = info.end;

            if (start >= endExclusive) {
                alert("La date de dÃ©but doit Ãªtre avant la date de fin.");
                calendar.unselect();
                return;
            }

            if (!confirm("Ajouter cette pÃ©riode de menstruation ?")) {
                calendar.unselect();
                return;
            }

            // Conversion en YYYY-MM-DD
            const startStr = start.toISOString().split('T')[0];
            const endStr = endExclusive.toISOString().split('T')[0];

            saveCycle(startStr, endStr);
        }
    });

    calendar.render();

    function saveCycle(start, end) {
        fetch("{{ path('cycle_add_ajax') }}", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "X-Requested-With": "XMLHttpRequest"
            },
            body: JSON.stringify({ start, end })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Ajouter un Ã©vÃ©nement par jour de la pÃ©riode
                let current = new Date(start);
                let endDate = new Date(end);
                while (current <= endDate) {
                    const dayStr = current.toISOString().split('T')[0];
                    calendar.addEvent({
                        title: 'ðŸ©¸',
                        start: dayStr,
                        allDay: true,
                        classNames: ['menstruation-event']
                    });
                    current.setDate(current.getDate() + 1);
                }
            }
            calendar.unselect();
        })
        .catch(() => {
            alert("Erreur lors de l'enregistrement du cycle.");
            calendar.unselect();
        });
    }

});
</script>

        

      </div>
    
  
    </main>

  
  

</div>
{% endblock %}
